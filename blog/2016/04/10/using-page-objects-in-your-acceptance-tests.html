<!doctype html> <html> <head> <meta charset=utf-8 /> <meta http-equiv=X-UA-Compatible content='IE=edge;chrome=1'/> <meta name=viewport content="width=device-width, initial-scale=1"> <title> Using Page Objects in your Acceptance Tests - gonzedge.com </title> <link rel=alternate type="application/atom+xml" title="Atom Feed" href="/blog/feed.xml"/> <link href="/stylesheets/all-3b0cf2bc.css" rel=stylesheet /> <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-72477714-1', 'auto');
  ga('send', 'pageview');

</script> </head> <body> <nav class="navbar navbar-default" role=nav> <div class=container> <div class=row> <div class="col-sm-3 col-xs-6"> <header class=navbar-header> <h1 class=navbar-title> <a href="/" class=navbar-brand> <code>@gonzedge</code> </a> </h1> </header> </div> <div class="col-sm-7 hidden-xs"> <p class="navbar-text hidden-xs hidden-sm"> <code>Adventures of a software development generalist</code> </p> </div> <div class="col-sm-2 col-xs-6"> <div class=navbar-right> <ul class="nav navbar-nav"> <li> <a href="https://github.com/gonzedge" class=social-link> <i class="fa fa-github"></i> </a> </li> </ul> </div> </div> </div> </div> </nav> <div class=container> <div class=row> <aside class="col-sm-3 hidden-xs"> <div class=sidebar-module> <h4> Featured <span class="pull-right see-more"> <a href="/blog/" class=button>See all posts →</a> </span> </h4> <ol class=list-unstyled> <li> <h5> <a href="/blog/2016/01/26/query-objects-in-the-rails-world-a-different-approach.html">Query Objects in the Rails world - A Different Approach</a> </h5> </li> <li> <h5> <a href="/blog/2018/02/15/ruby-performance-hash-has-key-vs-square-brackets.html">Ruby performance: Hash's #has_key? vs. #[] (square brackets)</a> </h5> </li> <li> <h5> <a href="/blog/2016/01/27/unit-testing-active-record-eager-loading.html">Unit Testing ActiveRecord eager-loading</a> </h5> </li> <li> <h5> <a href="/blog/2018/02/19/ruby-performance-attr-accessor-vs-def-method.html">Ruby performance: #attr_accessor vs. method definition</a> </h5> </li> <li> <h5> <a href="/blog/2016/04/10/using-page-objects-in-your-acceptance-tests.html">Using Page Objects in your Acceptance Tests</a> </h5> </li> <li> <h5> <a href="/blog/2018/02/11/ruby-performance-using-benchmarks-and-memory-profiler-to-chase-performance-degradations.html">Ruby performance: Using benchmarks and memory_profiler to chase performance degradations</a> </h5> </li> <li> <h5> <a href="/blog/2016/04/12/page-objects-where-do-you-put-your-assertions.html">Page Objects: Where do you put your assertions?</a> </h5> </li> <li> <h5> <a href="/blog/2012/04/27/git-removing-sensitive-data-and-rewriting-history.html">Git: Removing sensitive data and rewriting history</a> </h5> </li> <li> <h5> <a href="/blog/2016/04/12/specifying-failure-message-for-rspec-expectations.html">Specifying failure message for RSpec expectations</a> </h5> </li> <li> <h5> <a href="/blog/2016/01/11/installing-macvim-with-lua-enabled-through-homebrew.html">Installing MacVim with Lua enabled through Homebrew</a> </h5> </li> </ol> </div> <div class=sidebar-module> <h4> Recent <span class="pull-right see-more"> <a href="/blog/" class=button>See all posts →</a> </span> </h4> <ol class=list-unstyled> <li> <h5> <a href="/blog/2020/07/26/using-certbot-to-add-lets-encrypt-certificate-on-heroku.html">Using certbot to add Let's Encrypt certificate on Heroku</a> </h5> </li> <li> <h5> <a href="/blog/2018/02/19/ruby-performance-attr-accessor-vs-def-method.html">Ruby performance: #attr_accessor vs. method definition</a> </h5> </li> <li> <h5> <a href="/blog/2018/02/15/ruby-performance-hash-has-key-vs-square-brackets.html">Ruby performance: Hash's #has_key? vs. #[] (square brackets)</a> </h5> </li> <li> <h5> <a href="/blog/2018/02/11/ruby-performance-using-benchmarks-and-memory-profiler-to-chase-performance-degradations.html">Ruby performance: Using benchmarks and memory_profiler to chase performance degradations</a> </h5> </li> <li> <h5> <a href="/blog/2017/01/23/rambling-trie-1-0-0-released.html">Rambling Trie 1.0.0 released!</a> </h5> </li> <li> <h5> <a href="/blog/2016/04/12/page-objects-where-do-you-put-your-assertions.html">Page Objects: Where do you put your assertions?</a> </h5> </li> <li> <h5> <a href="/blog/2016/04/12/specifying-failure-message-for-rspec-expectations.html">Specifying failure message for RSpec expectations</a> </h5> </li> <li> <h5> <a href="/blog/2016/04/10/using-page-objects-in-your-acceptance-tests.html">Using Page Objects in your Acceptance Tests</a> </h5> </li> <li> <h5> <a href="/blog/2016/01/27/unit-testing-active-record-eager-loading.html">Unit Testing ActiveRecord eager-loading</a> </h5> </li> <li> <h5> <a href="/blog/2016/01/26/query-objects-in-the-rails-world-a-different-approach.html">Query Objects in the Rails world - A Different Approach</a> </h5> </li> </ol> </div> <div class=sidebar-module> <h4>Tags</h4> <ol class="list-inline tags"> <li> <h5> <a href="/blog/tags/ruby.html">ruby (35)</a> </h5> </li> <li> <h5> <a href="/blog/tags/instructions.html">instructions (34)</a> </h5> </li> <li> <h5> <a href="/blog/tags/plugins-and-libraries.html">plugins and libraries (24)</a> </h5> </li> <li> <h5> <a href="/blog/tags/rails.html">rails (24)</a> </h5> </li> <li> <h5> <a href="/blog/tags/releases.html">releases (18)</a> </h5> </li> <li> <h5> <a href="/blog/tags/rambling-slider.html">rambling-slider (17)</a> </h5> </li> <li> <h5> <a href="/blog/tags/jquery.html">jquery (16)</a> </h5> </li> <li> <h5> <a href="/blog/tags/rails-3-1.html">rails 3.1 (16)</a> </h5> </li> <li> <h5> <a href="/blog/tags/rubygems.html">rubygems (15)</a> </h5> </li> <li> <h5> <a href="/blog/tags/slider.html">slider (14)</a> </h5> </li> <li> <h5> <a href="/blog/tags/nivo-slider.html">nivo slider (14)</a> </h5> </li> <li> <h5> <a href="/blog/tags/rambling.html">rambling (12)</a> </h5> </li> <li> <h5> <a href="/blog/tags/fixes.html">fixes (11)</a> </h5> </li> <li> <h5> <a href="/blog/tags/new-site.html">new site (8)</a> </h5> </li> <li> <h5> <a href="/blog/tags/rambling-trie.html">rambling-trie (8)</a> </h5> </li> <li> <h5> <a href="/blog/tags/performance.html">performance (7)</a> </h5> </li> <li> <h5> <a href="/blog/tags/data-structure.html">data structure (7)</a> </h5> </li> <li> <h5> <a href="/blog/tags/testing.html">testing (6)</a> </h5> </li> <li> <h5> <a href="/blog/tags/vim.html">vim (5)</a> </h5> </li> <li> <h5> <a href="/blog/tags/bugs.html">bugs (5)</a> </h5> </li> <li> <h5> <a href="/blog/tags/opinions.html">opinions (5)</a> </h5> </li> <li> <h5> <a href="/blog/tags/javascript.html">javascript (5)</a> </h5> </li> <li> <h5> <a href="/blog/tags/refactoring.html">refactoring (5)</a> </h5> </li> <li> <h5> <a href="/blog/tags/git.html">git (4)</a> </h5> </li> <li> <h5> <a href="/blog/tags/coffeescript.html">coffeescript (4)</a> </h5> </li> <li> <h5> <a href="/blog/tags/flash.html">flash (3)</a> </h5> </li> <li> <h5> <a href="/blog/tags/heroku.html">heroku (3)</a> </h5> </li> <li> <h5> <a href="/blog/tags/rambling-slider-rails.html">rambling-slider-rails (3)</a> </h5> </li> <li> <h5> <a href="/blog/tags/capybara.html">capybara (3)</a> </h5> </li> <li> <h5> <a href="/blog/tags/rvm.html">rvm (3)</a> </h5> </li> <li> <h5> <a href="/blog/tags/design-patterns.html">design-patterns (3)</a> </h5> </li> <li> <h5> <a href="/blog/tags/new-look.html">new look (3)</a> </h5> </li> <li> <h5> <a href="/blog/tags/rubymine.html">rubymine (2)</a> </h5> </li> <li> <h5> <a href="/blog/tags/markdown.html">markdown (2)</a> </h5> </li> <li> <h5> <a href="/blog/tags/error-handling.html">error handling (2)</a> </h5> </li> <li> <h5> <a href="/blog/tags/database-migrations.html">database migrations (2)</a> </h5> </li> <li> <h5> <a href="/blog/tags/ssh.html">ssh (2)</a> </h5> </li> <li> <h5> <a href="/blog/tags/ubuntu.html">ubuntu (2)</a> </h5> </li> <li> <h5> <a href="/blog/tags/cyanogenmod.html">cyanogenmod (2)</a> </h5> </li> <li> <h5> <a href="/blog/tags/nodejs.html">nodejs (2)</a> </h5> </li> <li> <h5> <a href="/blog/tags/haml.html">haml (2)</a> </h5> </li> <li> <h5> <a href="/blog/tags/jasmine.html">jasmine (2)</a> </h5> </li> <li> <h5> <a href="/blog/tags/android.html">android (2)</a> </h5> </li> <li> <h5> <a href="/blog/tags/selenium.html">selenium (2)</a> </h5> </li> <li> <h5> <a href="/blog/tags/nokogiri.html">nokogiri (2)</a> </h5> </li> <li> <h5> <a href="/blog/tags/refinerycms.html">refinerycms (2)</a> </h5> </li> <li> <h5> <a href="/blog/tags/internet-explorer.html">internet explorer (2)</a> </h5> </li> <li> <h5> <a href="/blog/tags/mercurial.html">mercurial (1)</a> </h5> </li> <li> <h5> <a href="/blog/tags/jetbrains.html">jetbrains (1)</a> </h5> </li> <li> <h5> <a href="/blog/tags/windows.html">windows (1)</a> </h5> </li> <li> <h5> <a href="/blog/tags/actionmailer.html">actionmailer (1)</a> </h5> </li> <li> <h5> <a href="/blog/tags/postgresql.html">postgresql (1)</a> </h5> </li> <li> <h5> <a href="/blog/tags/i18n.html">i18n (1)</a> </h5> </li> <li> <h5> <a href="/blog/tags/capybara-webkit.html">capybara-webkit (1)</a> </h5> </li> <li> <h5> <a href="/blog/tags/will-paginate.html">will_paginate (1)</a> </h5> </li> <li> <h5> <a href="/blog/tags/deployment.html">deployment (1)</a> </h5> </li> <li> <h5> <a href="/blog/tags/activerecord.html">activerecord (1)</a> </h5> </li> <li> <h5> <a href="/blog/tags/background-tasks.html">background tasks (1)</a> </h5> </li> <li> <h5> <a href="/blog/tags/cron.html">cron (1)</a> </h5> </li> <li> <h5> <a href="/blog/tags/simple-navigation.html">simple-navigation (1)</a> </h5> </li> <li> <h5> <a href="/blog/tags/html.html">html (1)</a> </h5> </li> <li> <h5> <a href="/blog/tags/erb.html">erb (1)</a> </h5> </li> <li> <h5> <a href="/blog/tags/assets.html">assets (1)</a> </h5> </li> <li> <h5> <a href="/blog/tags/bash.html">bash (1)</a> </h5> </li> <li> <h5> <a href="/blog/tags/github.html">github (1)</a> </h5> </li> <li> <h5> <a href="/blog/tags/pygments.html">pygments (1)</a> </h5> </li> <li> <h5> <a href="/blog/tags/lua.html">lua (1)</a> </h5> </li> <li> <h5> <a href="/blog/tags/homebrew.html">homebrew (1)</a> </h5> </li> <li> <h5> <a href="/blog/tags/powershell.html">powershell (1)</a> </h5> </li> </ol> </div> </aside> <div id=main class=col-sm-9 role=main> <h1> Using Page Objects in your Acceptance Tests </h1> <p> <small>April 10, 2016</small> </p> <p>If you&rsquo;ve written <a href="http://c2.com/cgi/wiki?AcceptanceTest">acceptance tests</a> for web applications in the past (also called feature tests), you might be familiar with tools like <a href="https://github.com/jnicklas/capybara">Capybara</a>, <a href="https://github.com/dgageot/simplelenium">Simplelenium</a> and <a href="https://github.com/FluentLenium/FluentLenium">FluentLenium</a>. These are great abstractions over the browser (<a href="http://docs.seleniumhq.org/">thanks, Selenium!</a>) that provide very nice APIs for testing web applications.</p> <p>If you&rsquo;ve done this for a while, you might also have heard of <a href="http://martinfowler.com/bliki/PageObject.html">Page Objects</a>. The idea behind them is that your tests should be about the behavior of your application and not about the underlying HTML, since the HTML is an implementation detail and probably not the interesting part of your tests.</p> <h2>Our base acceptance test</h2> <p>Let&rsquo;s assume that we are working on an application where you can browse and review restaurants and we have an acceptance test that goes like this:</p> <div class=highlight><pre class="highlight ruby"><code><span class="c1"># spec/features/reviewing_a_restaurant_spec.rb</span>
<span class="n">feature</span> <span class="s1">'Reviewing a restaurant'</span> <span class="k">do</span>
  <span class="n">background</span> <span class="k">do</span>
    <span class="c1"># create a user in the database</span>
  <span class="k">end</span>

  <span class="n">scenario</span> <span class="s1">'user writes a two-star review for a restaurant'</span> <span class="k">do</span>
    <span class="n">visit</span> <span class="n">root_path</span>
    <span class="n">click_on</span> <span class="s1">'Sign In'</span>

    <span class="n">within</span> <span class="s1">'.sign-in-form'</span> <span class="k">do</span>
      <span class="n">fill_in</span> <span class="s1">'Email'</span><span class="p">,</span> <span class="ss">with: </span><span class="s1">'myemail@example.org'</span>
      <span class="n">fill_in</span> <span class="s1">'Password'</span><span class="p">,</span> <span class="ss">with: </span><span class="s1">'anawesomepassword'</span>
      <span class="n">click_on</span> <span class="s1">'Sign In'</span>
    <span class="k">end</span>

    <span class="n">fill_in</span> <span class="s1">'Search'</span><span class="p">,</span> <span class="ss">with: </span><span class="s1">'Steakhouse'</span>
    <span class="n">click_on</span> <span class="s1">'Go'</span>
    <span class="n">within</span> <span class="s1">'.search-results'</span> <span class="k">do</span>
      <span class="n">click_on</span> <span class="s2">"Freddy's Unclean Steakhouse"</span>
    <span class="k">end</span>

    <span class="n">click_on</span> <span class="s1">'Write a Review'</span>
    <span class="n">click_on</span> <span class="s1">'.rating[data-rating="2"]'</span>
    <span class="n">fill_in</span> <span class="s1">'Comments'</span><span class="p">,</span> <span class="ss">with: </span><span class="s1">'Did NOT like it'</span>
    <span class="n">click_on</span> <span class="s1">'Save'</span>

    <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">).</span><span class="nf">to</span> <span class="n">have_content</span> <span class="s1">'Your review has been saved!'</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">).</span><span class="nf">to</span> <span class="n">have_content</span> <span class="s2">"Freddy's Unclean Steakhouse"</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">).</span><span class="nf">to</span> <span class="n">have_selector</span> <span class="s1">'.rating[data-rating="2"].selected'</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">).</span><span class="nf">to</span> <span class="n">have_content</span> <span class="s1">'Did NOT like it'</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div> <p>The test above is fine, but we can do better. It&rsquo;s very hard to see what the test is about with all the clicks and all the form filling happening.</p> <h2>Extracting methods to clarify intent</h2> <p>Let&rsquo;s extract a few methods to better communicate what we&rsquo;re trying to validate with this test:</p> <div class=highlight><pre class="highlight ruby"><code><span class="c1"># spec/features/reviewing_a_restaurant_spec.rb</span>
<span class="n">feature</span> <span class="s1">'Reviewing a restaurant'</span> <span class="k">do</span>
  <span class="c1"># ...</span>

  <span class="n">scenario</span> <span class="s1">'user writes a two-star review for a restaurant'</span> <span class="k">do</span>
    <span class="n">user_signs_in</span>
    <span class="n">user_searches_for_a_restaurant</span>
    <span class="n">user_writes_a_two_star_review</span>
    <span class="n">user_sees_two_star_review_on_restaurant</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">user_signs_in</span>
    <span class="n">visit</span> <span class="n">root_path</span>
    <span class="n">click_on</span> <span class="s1">'Sign In'</span>

    <span class="n">within</span> <span class="s1">'.sign-in-form'</span> <span class="k">do</span>
      <span class="n">fill_in</span> <span class="s1">'Email'</span><span class="p">,</span> <span class="ss">with: </span><span class="s1">'myemail@example.org'</span>
      <span class="n">fill_in</span> <span class="s1">'Password'</span><span class="p">,</span> <span class="ss">with: </span><span class="s1">'anawesomepassword'</span>
      <span class="n">click_on</span> <span class="s1">'Sign In'</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">user_searches_for_a_restaurant</span>
    <span class="n">fill_in</span> <span class="s1">'Search'</span><span class="p">,</span> <span class="ss">with: </span><span class="s1">'Steakhouse'</span>
    <span class="n">click_on</span> <span class="s1">'Go'</span>
    <span class="n">within</span> <span class="s1">'.search-results'</span> <span class="k">do</span>
      <span class="n">click_on</span> <span class="s2">"Freddy's Unclean Steakhouse"</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">user_writes_a_two_star_review</span>
    <span class="n">click_on</span> <span class="s1">'Write a Review'</span>
    <span class="n">click_on</span> <span class="s1">'.rating[data-rating="2"]'</span>
    <span class="n">fill_in</span> <span class="s1">'Comments'</span><span class="p">,</span> <span class="ss">with: </span><span class="s1">'Did NOT like it'</span>
    <span class="n">click_on</span> <span class="s1">'Save'</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">user_sees_two_star_review_on_restaurant</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">).</span><span class="nf">to</span> <span class="n">have_content</span> <span class="s1">'Your review has been saved!'</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">).</span><span class="nf">to</span> <span class="n">have_content</span> <span class="s2">"Freddy's Unclean Steakhouse"</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">).</span><span class="nf">to</span> <span class="n">have_selector</span> <span class="s1">'.rating[data-rating="2"].selected'</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">).</span><span class="nf">to</span> <span class="n">have_content</span> <span class="s1">'Did NOT like it'</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div> <p>That&rsquo;s definitely better. We are expressing our intent in the test itself. But&hellip; we can still do better. This test file continues to be too coupled to the specific details of how to interact with the HTML. Additionally, the assertions that we have at the end are not specific enough since the contained strings could be anywhere on the page. This does not bode well.</p> <h2>Using Page Objects</h2> <p>Let&rsquo;s extract a few Page Objects. Some of them will represent the whole web page being displayed and other will represent particular sections of such page:</p> <div class=highlight><pre class="highlight ruby"><code><span class="c1"># spec/features/pages/sign_in_page.rb</span>
<span class="k">module</span> <span class="nn">Pages</span>
  <span class="k">class</span> <span class="nc">SignInPage</span>
    <span class="kp">include</span> <span class="no">Capybara</span><span class="o">::</span><span class="no">DSL</span>

    <span class="k">def</span> <span class="nf">navigate</span>
      <span class="n">visit</span> <span class="n">root_path</span>
      <span class="n">click_on</span> <span class="s1">'Sign In'</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">sign_in</span><span class="p">(</span><span class="n">email</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
      <span class="n">within</span> <span class="s1">'.sign-in-form'</span> <span class="k">do</span>
        <span class="n">fill_in</span> <span class="s1">'Email'</span><span class="p">,</span> <span class="ss">with: </span><span class="n">email</span>
        <span class="n">fill_in</span> <span class="s1">'Password'</span><span class="p">,</span> <span class="ss">with: </span><span class="n">password</span>
        <span class="n">click_on</span> <span class="s1">'Sign In'</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># spec/features/pages/search_page.rb</span>
<span class="k">module</span> <span class="nn">Pages</span>
  <span class="k">class</span> <span class="nc">SearchPage</span>
    <span class="kp">include</span> <span class="no">Capybara</span><span class="o">::</span><span class="no">DSL</span>

    <span class="k">def</span> <span class="nf">search_for</span><span class="p">(</span><span class="n">term</span><span class="p">)</span>
      <span class="n">fill_in</span> <span class="s1">'Search'</span><span class="p">,</span> <span class="ss">with: </span><span class="n">term</span>
      <span class="n">click_on</span> <span class="s1">'Go'</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">results</span>
      <span class="n">all</span><span class="p">(</span><span class="s1">'.search-results a'</span><span class="p">).</span><span class="nf">map</span> <span class="k">do</span> <span class="o">|</span><span class="n">element</span><span class="o">|</span>
        <span class="no">Pages</span><span class="o">::</span><span class="no">Search</span><span class="o">::</span><span class="no">Result</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># spec/features/pages/search/result.rb</span>
<span class="k">module</span> <span class="nn">Pages</span>
  <span class="k">module</span> <span class="nn">Search</span>
    <span class="k">class</span> <span class="nc">Result</span>
      <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
        <span class="vi">@element</span> <span class="o">=</span> <span class="n">element</span>
      <span class="k">end</span>

      <span class="k">def</span> <span class="nf">name</span>
        <span class="n">element</span><span class="p">.</span><span class="nf">text</span>
      <span class="k">end</span>

      <span class="k">def</span> <span class="nf">view</span>
        <span class="n">element</span><span class="p">.</span><span class="nf">click</span>
      <span class="k">end</span>

      <span class="kp">private</span>

      <span class="nb">attr_reader</span> <span class="ss">:element</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># spec/features/pages/restaurant_page.rb</span>
<span class="k">module</span> <span class="nn">Pages</span>
  <span class="k">class</span> <span class="nc">RestaurantPage</span>
    <span class="kp">include</span> <span class="no">Capybara</span><span class="o">::</span><span class="no">DSL</span>

    <span class="k">def</span> <span class="nf">name</span>
      <span class="n">find</span><span class="p">(</span><span class="s1">'h1'</span><span class="p">).</span><span class="nf">text</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">has_success_message?</span>
      <span class="n">has_selector?</span> <span class="s1">'[data-flash-success]'</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">success_message</span>
      <span class="n">find</span><span class="p">(</span><span class="s1">'[data-flash-success]'</span><span class="p">).</span><span class="nf">text</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">reviews</span>
      <span class="n">all</span><span class="p">(</span><span class="s1">'.review'</span><span class="p">).</span><span class="nf">map</span> <span class="k">do</span> <span class="o">|</span><span class="n">element</span><span class="o">|</span>
        <span class="no">Pages</span><span class="o">::</span><span class="no">Restaurant</span><span class="o">::</span><span class="no">Review</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">write_review</span><span class="p">(</span><span class="n">stars</span><span class="p">,</span> <span class="n">comments</span><span class="p">)</span>
      <span class="n">click_on</span> <span class="s1">'Write a Review'</span>
      <span class="n">click_on</span> <span class="n">rating_selectors</span><span class="p">[</span><span class="n">stars</span><span class="p">]</span>
      <span class="n">fill_in</span> <span class="s1">'Comments'</span><span class="p">,</span> <span class="ss">with: </span><span class="n">comments</span>
      <span class="n">click_on</span> <span class="s1">'Save'</span>
    <span class="k">end</span>

    <span class="kp">private</span>

    <span class="k">def</span> <span class="nf">rating_selectors</span>
      <span class="p">{</span>
        <span class="mi">1</span> <span class="o">=&gt;</span> <span class="s1">'[data-rating="1"]'</span><span class="p">,</span>
        <span class="mi">2</span> <span class="o">=&gt;</span> <span class="s1">'[data-rating="2"]'</span><span class="p">,</span>
        <span class="mi">3</span> <span class="o">=&gt;</span> <span class="s1">'[data-rating="3"]'</span><span class="p">,</span>
        <span class="mi">4</span> <span class="o">=&gt;</span> <span class="s1">'[data-rating="4"]'</span><span class="p">,</span>
        <span class="mi">5</span> <span class="o">=&gt;</span> <span class="s1">'[data-rating="5"]'</span><span class="p">,</span>
      <span class="p">}</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># spec/features/pages/restaurant/review.rb</span>
<span class="k">module</span> <span class="nn">Pages</span>
  <span class="k">module</span> <span class="nn">Restaurant</span>
    <span class="k">class</span> <span class="nc">Review</span>
      <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
        <span class="vi">@element</span> <span class="o">=</span> <span class="n">element</span>
      <span class="k">end</span>

      <span class="k">def</span> <span class="nf">rating</span>
        <span class="n">within</span> <span class="n">element</span> <span class="k">do</span>
          <span class="n">find</span><span class="p">(</span><span class="s1">'.rating.selected'</span><span class="p">)[</span><span class="s1">'data-rating'</span><span class="p">].</span><span class="nf">to_i</span>
        <span class="k">end</span>
      <span class="k">end</span>

      <span class="k">def</span> <span class="nf">comments</span>
        <span class="n">within</span> <span class="n">element</span> <span class="k">do</span>
          <span class="n">find</span><span class="p">(</span><span class="s1">'.comments'</span><span class="p">).</span><span class="nf">text</span>
        <span class="k">end</span>
      <span class="k">end</span>

      <span class="kp">private</span>

      <span class="nb">attr_reader</span> <span class="ss">:element</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div> <p>And now, we can rewrite our acceptance test like this:</p> <div class=highlight><pre class="highlight ruby"><code><span class="c1"># spec/features/reviewing_a_restaurant_spec.rb</span>
<span class="nb">require_relative</span> <span class="s1">'pages/sign_in_page'</span>
<span class="nb">require_relative</span> <span class="s1">'pages/search_page'</span>
<span class="nb">require_relative</span> <span class="s1">'pages/restaurant_page'</span>
<span class="nb">require_relative</span> <span class="s1">'pages/restaurant/review'</span>

<span class="n">feature</span> <span class="s1">'Reviewing a restaurant'</span> <span class="k">do</span>
  <span class="c1"># ...</span>

  <span class="n">scenario</span> <span class="s1">'user writes a two-star review for a restaurant'</span> <span class="k">do</span>
    <span class="n">user_signs_in</span>
    <span class="n">user_searches_for_a_restaurant</span>
    <span class="n">user_writes_a_two_star_review</span>
    <span class="n">user_sees_two_star_review_on_restaurant</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">user_signs_in</span>
    <span class="n">sign_in_page</span><span class="p">.</span><span class="nf">navigate</span>
    <span class="n">sign_in_page</span><span class="p">.</span><span class="nf">sign_in</span> <span class="s1">'myemail@example.org'</span><span class="p">,</span> <span class="s1">'anawesomepassword'</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">user_searches_for_a_restaurant</span>
    <span class="n">search_page</span><span class="p">.</span><span class="nf">search_for</span> <span class="s1">'Steakhouse'</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">search_page</span><span class="p">.</span><span class="nf">results</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span> <span class="mi">1</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">search_page</span><span class="p">.</span><span class="nf">results</span><span class="p">.</span><span class="nf">first</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="nf">name</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span> <span class="s2">"Freddy's Unclean Steakhouse"</span>
    <span class="n">result</span><span class="p">.</span><span class="nf">view</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">user_writes_a_two_star_review</span>
    <span class="n">restaurant_page</span><span class="p">.</span><span class="nf">write_review</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">'Did NOT like it'</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">user_sees_two_star_review_on_restaurant</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">restaurant_page</span><span class="p">.</span><span class="nf">name</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span> <span class="s2">"Freddy's Unclean Steakhouse"</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">restaurant_page</span><span class="p">.</span><span class="nf">has_success_message?</span><span class="p">).</span><span class="nf">to</span> <span class="n">be</span> <span class="kp">true</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">restaurant_page</span><span class="p">.</span><span class="nf">success_message</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span> <span class="s1">'Your review has been saved!'</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">restaurant_page</span><span class="p">.</span><span class="nf">reviews</span><span class="p">.</span><span class="nf">count</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span> <span class="mi">1</span>

    <span class="n">review</span> <span class="o">=</span> <span class="n">restaurant_page</span><span class="p">.</span><span class="nf">reviews</span><span class="p">.</span><span class="nf">first</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">review</span><span class="p">.</span><span class="nf">rating</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span> <span class="mi">2</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">review</span><span class="p">.</span><span class="nf">comments</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span> <span class="s1">'Did NOT like it'</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div> <p>As you can see, these Page Objects give us better ways to express the intent of the test. We are now expecting the first review in the rated restaurant page to have a particular rating and a particular comment, instead of just asserting that the number and text are in the page. We could&rsquo;ve achieved that without Page Objects, but having Page Objects allowed us to get the HTML handling out of the way and really focus on writing an interesting test. We even added an assertion to count the number of reviews on the page.</p> <p>On top of that, this gives us the added benefit of reducing duplication. If we had other tests with similar steps and all of a sudden we realized that we needed to change the way we sign into the application or the way we search for restaurants, it wouldn&rsquo;t be fun to go through all of the acceptance test files to change the same thing over and over again. In our case, we would now just have to go to the <code>SignInPage</code> or the <code>SearchPage</code> to reflect the new changes and, voilà, all the tests are updated.</p> <p>A common occurrence with acceptance tests, especially for applications that are JavaScript heavy (and what app isn&rsquo;t these days?!), is that they start failing intermittently (a.k.a. flakey tests), usually because we&rsquo;re trying to interact with the browser without giving it time to fully process the results of some JavaScript action. Page Objects can help with this, because you can wait for the right elements to appear or disappear from the page after a particular action was taken without ever revealing this to the tests using the page object.</p> <p>One last benefit I want to mention is that, like domain objects, Page Objects allow the team, developers or not, to speak in the same language. Everyone knows what you&rsquo;re talking about when you refer to the reviews list in the restaurant page, and if the tests reflect that, it means there is a lower mental barrier to cross whenever you need to translate acceptance criteria into tests.</p> <hr> <h2>Extracting a couple of base utility objects</h2> <p>From the Page Objects described before, you can easily reduce duplication between Page Objects by extracting a base page and component objects:</p> <div class=highlight><pre class="highlight ruby"><code><span class="c1"># spec/features/pages/page_component.rb</span>
<span class="k">module</span> <span class="nn">Pages</span>
  <span class="k">class</span> <span class="nc">Page</span>
    <span class="kp">include</span> <span class="no">Capybara</span><span class="o">::</span><span class="no">DSL</span>

    <span class="k">def</span> <span class="nf">has_success_message?</span>
      <span class="n">has_selector?</span> <span class="s1">'[data-flash-success]'</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">success_message</span>
      <span class="n">find</span><span class="p">(</span><span class="s1">'[data-flash-success]'</span><span class="p">).</span><span class="nf">text</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># spec/features/pages/page_component.rb</span>
<span class="k">module</span> <span class="nn">Pages</span>
  <span class="k">class</span> <span class="nc">PageComponent</span>
    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
      <span class="vi">@element</span> <span class="o">=</span> <span class="n">element</span>
    <span class="k">end</span>

    <span class="kp">private</span>

    <span class="k">def</span> <span class="nf">within_element</span>
      <span class="n">within</span> <span class="n">element</span> <span class="k">do</span>
        <span class="k">yield</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="nb">attr_reader</span> <span class="ss">:element</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div> <p>With these, you can now define a shorter implementation for the <code>Review</code>:</p> <div class=highlight><pre class="highlight ruby"><code><span class="c1"># spec/features/pages/restaurant/review.rb</span>
<span class="k">module</span> <span class="nn">Pages</span>
  <span class="k">module</span> <span class="nn">Restaurant</span>
    <span class="k">class</span> <span class="nc">Review</span> <span class="o">&lt;</span> <span class="no">Pages</span><span class="o">::</span><span class="no">PageComponent</span>
      <span class="k">def</span> <span class="nf">rating</span>
        <span class="n">within_element</span> <span class="k">do</span>
          <span class="n">find</span><span class="p">(</span><span class="s1">'.rating.selected'</span><span class="p">)[</span><span class="s1">'data-rating'</span><span class="p">].</span><span class="nf">to_i</span>
        <span class="k">end</span>
      <span class="k">end</span>

      <span class="k">def</span> <span class="nf">comments</span>
        <span class="n">within_element</span> <span class="k">do</span>
          <span class="n">find</span><span class="p">(</span><span class="s1">'.comments'</span><span class="p">).</span><span class="nf">text</span>
        <span class="k">end</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div> <p>That&rsquo;s it for this time. Enjoy your new and shiny acceptance tests!</p> <hr> <p><strong>Notes</strong></p> <ul> <li>Updated on 2016-04-11 to use a better name for the restaurant receiving that review. Thanks to <a href="https://github.com/MarkyMarkMcDonald">Mark McDonald</a> for pointing that out!</li> <li>Updated on 2016-04-24 to use the <code>all</code> method instead of <code>find</code> when looking for element collections</li> </ul> <section id=disqus_thread class=comments-section></section> <script>
  (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');

    s.src = '//gonzedge.disqus.com/embed.js';

    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel=nofollow>comments powered by Disqus.</a></noscript> </div> <aside class="col-sm-3 visible-xs-block"> <div class=sidebar-module> <h4> Recent <span class="pull-right see-more"> <a href="/blog/" class=button>See all posts →</a> </span> </h4> <ol class=list-unstyled> <li> <h5> <a href="/blog/2020/07/26/using-certbot-to-add-lets-encrypt-certificate-on-heroku.html">Using certbot to add Let's Encrypt certificate on Heroku</a> </h5> </li> <li> <h5> <a href="/blog/2018/02/19/ruby-performance-attr-accessor-vs-def-method.html">Ruby performance: #attr_accessor vs. method definition</a> </h5> </li> <li> <h5> <a href="/blog/2018/02/15/ruby-performance-hash-has-key-vs-square-brackets.html">Ruby performance: Hash's #has_key? vs. #[] (square brackets)</a> </h5> </li> <li> <h5> <a href="/blog/2018/02/11/ruby-performance-using-benchmarks-and-memory-profiler-to-chase-performance-degradations.html">Ruby performance: Using benchmarks and memory_profiler to chase performance degradations</a> </h5> </li> <li> <h5> <a href="/blog/2017/01/23/rambling-trie-1-0-0-released.html">Rambling Trie 1.0.0 released!</a> </h5> </li> <li> <h5> <a href="/blog/2016/04/12/page-objects-where-do-you-put-your-assertions.html">Page Objects: Where do you put your assertions?</a> </h5> </li> <li> <h5> <a href="/blog/2016/04/12/specifying-failure-message-for-rspec-expectations.html">Specifying failure message for RSpec expectations</a> </h5> </li> <li> <h5> <a href="/blog/2016/04/10/using-page-objects-in-your-acceptance-tests.html">Using Page Objects in your Acceptance Tests</a> </h5> </li> <li> <h5> <a href="/blog/2016/01/27/unit-testing-active-record-eager-loading.html">Unit Testing ActiveRecord eager-loading</a> </h5> </li> <li> <h5> <a href="/blog/2016/01/26/query-objects-in-the-rails-world-a-different-approach.html">Query Objects in the Rails world - A Different Approach</a> </h5> </li> </ol> </div> <div class=sidebar-module> <h4>Tags</h4> <ol class="list-inline tags"> <li> <h5> <a href="/blog/tags/ruby.html">ruby (35)</a> </h5> </li> <li> <h5> <a href="/blog/tags/instructions.html">instructions (34)</a> </h5> </li> <li> <h5> <a href="/blog/tags/plugins-and-libraries.html">plugins and libraries (24)</a> </h5> </li> <li> <h5> <a href="/blog/tags/rails.html">rails (24)</a> </h5> </li> <li> <h5> <a href="/blog/tags/releases.html">releases (18)</a> </h5> </li> <li> <h5> <a href="/blog/tags/rambling-slider.html">rambling-slider (17)</a> </h5> </li> <li> <h5> <a href="/blog/tags/jquery.html">jquery (16)</a> </h5> </li> <li> <h5> <a href="/blog/tags/rails-3-1.html">rails 3.1 (16)</a> </h5> </li> <li> <h5> <a href="/blog/tags/rubygems.html">rubygems (15)</a> </h5> </li> <li> <h5> <a href="/blog/tags/slider.html">slider (14)</a> </h5> </li> <li> <h5> <a href="/blog/tags/nivo-slider.html">nivo slider (14)</a> </h5> </li> <li> <h5> <a href="/blog/tags/rambling.html">rambling (12)</a> </h5> </li> <li> <h5> <a href="/blog/tags/fixes.html">fixes (11)</a> </h5> </li> <li> <h5> <a href="/blog/tags/new-site.html">new site (8)</a> </h5> </li> <li> <h5> <a href="/blog/tags/rambling-trie.html">rambling-trie (8)</a> </h5> </li> <li> <h5> <a href="/blog/tags/performance.html">performance (7)</a> </h5> </li> <li> <h5> <a href="/blog/tags/data-structure.html">data structure (7)</a> </h5> </li> <li> <h5> <a href="/blog/tags/testing.html">testing (6)</a> </h5> </li> <li> <h5> <a href="/blog/tags/vim.html">vim (5)</a> </h5> </li> <li> <h5> <a href="/blog/tags/bugs.html">bugs (5)</a> </h5> </li> <li> <h5> <a href="/blog/tags/opinions.html">opinions (5)</a> </h5> </li> <li> <h5> <a href="/blog/tags/javascript.html">javascript (5)</a> </h5> </li> <li> <h5> <a href="/blog/tags/refactoring.html">refactoring (5)</a> </h5> </li> <li> <h5> <a href="/blog/tags/git.html">git (4)</a> </h5> </li> <li> <h5> <a href="/blog/tags/coffeescript.html">coffeescript (4)</a> </h5> </li> <li> <h5> <a href="/blog/tags/flash.html">flash (3)</a> </h5> </li> <li> <h5> <a href="/blog/tags/heroku.html">heroku (3)</a> </h5> </li> <li> <h5> <a href="/blog/tags/rambling-slider-rails.html">rambling-slider-rails (3)</a> </h5> </li> <li> <h5> <a href="/blog/tags/capybara.html">capybara (3)</a> </h5> </li> <li> <h5> <a href="/blog/tags/rvm.html">rvm (3)</a> </h5> </li> <li> <h5> <a href="/blog/tags/design-patterns.html">design-patterns (3)</a> </h5> </li> <li> <h5> <a href="/blog/tags/new-look.html">new look (3)</a> </h5> </li> <li> <h5> <a href="/blog/tags/rubymine.html">rubymine (2)</a> </h5> </li> <li> <h5> <a href="/blog/tags/markdown.html">markdown (2)</a> </h5> </li> <li> <h5> <a href="/blog/tags/error-handling.html">error handling (2)</a> </h5> </li> <li> <h5> <a href="/blog/tags/database-migrations.html">database migrations (2)</a> </h5> </li> <li> <h5> <a href="/blog/tags/ssh.html">ssh (2)</a> </h5> </li> <li> <h5> <a href="/blog/tags/ubuntu.html">ubuntu (2)</a> </h5> </li> <li> <h5> <a href="/blog/tags/cyanogenmod.html">cyanogenmod (2)</a> </h5> </li> <li> <h5> <a href="/blog/tags/nodejs.html">nodejs (2)</a> </h5> </li> <li> <h5> <a href="/blog/tags/haml.html">haml (2)</a> </h5> </li> <li> <h5> <a href="/blog/tags/jasmine.html">jasmine (2)</a> </h5> </li> <li> <h5> <a href="/blog/tags/android.html">android (2)</a> </h5> </li> <li> <h5> <a href="/blog/tags/selenium.html">selenium (2)</a> </h5> </li> <li> <h5> <a href="/blog/tags/nokogiri.html">nokogiri (2)</a> </h5> </li> <li> <h5> <a href="/blog/tags/refinerycms.html">refinerycms (2)</a> </h5> </li> <li> <h5> <a href="/blog/tags/internet-explorer.html">internet explorer (2)</a> </h5> </li> <li> <h5> <a href="/blog/tags/mercurial.html">mercurial (1)</a> </h5> </li> <li> <h5> <a href="/blog/tags/jetbrains.html">jetbrains (1)</a> </h5> </li> <li> <h5> <a href="/blog/tags/windows.html">windows (1)</a> </h5> </li> <li> <h5> <a href="/blog/tags/actionmailer.html">actionmailer (1)</a> </h5> </li> <li> <h5> <a href="/blog/tags/postgresql.html">postgresql (1)</a> </h5> </li> <li> <h5> <a href="/blog/tags/i18n.html">i18n (1)</a> </h5> </li> <li> <h5> <a href="/blog/tags/capybara-webkit.html">capybara-webkit (1)</a> </h5> </li> <li> <h5> <a href="/blog/tags/will-paginate.html">will_paginate (1)</a> </h5> </li> <li> <h5> <a href="/blog/tags/deployment.html">deployment (1)</a> </h5> </li> <li> <h5> <a href="/blog/tags/activerecord.html">activerecord (1)</a> </h5> </li> <li> <h5> <a href="/blog/tags/background-tasks.html">background tasks (1)</a> </h5> </li> <li> <h5> <a href="/blog/tags/cron.html">cron (1)</a> </h5> </li> <li> <h5> <a href="/blog/tags/simple-navigation.html">simple-navigation (1)</a> </h5> </li> <li> <h5> <a href="/blog/tags/html.html">html (1)</a> </h5> </li> <li> <h5> <a href="/blog/tags/erb.html">erb (1)</a> </h5> </li> <li> <h5> <a href="/blog/tags/assets.html">assets (1)</a> </h5> </li> <li> <h5> <a href="/blog/tags/bash.html">bash (1)</a> </h5> </li> <li> <h5> <a href="/blog/tags/github.html">github (1)</a> </h5> </li> <li> <h5> <a href="/blog/tags/pygments.html">pygments (1)</a> </h5> </li> <li> <h5> <a href="/blog/tags/lua.html">lua (1)</a> </h5> </li> <li> <h5> <a href="/blog/tags/homebrew.html">homebrew (1)</a> </h5> </li> <li> <h5> <a href="/blog/tags/powershell.html">powershell (1)</a> </h5> </li> </ol> </div> <div class=sidebar-module> <h4>By Year</h4> <ol class=list-unstyled> <li> <h5> <a href="/blog/2020.html">2020 (1)</a> </h5> </li> <li> <h5> <a href="/blog/2018.html">2018 (3)</a> </h5> </li> <li> <h5> <a href="/blog/2017.html">2017 (1)</a> </h5> </li> <li> <h5> <a href="/blog/2016.html">2016 (6)</a> </h5> </li> <li> <h5> <a href="/blog/2012.html">2012 (19)</a> </h5> </li> <li> <h5> <a href="/blog/2011.html">2011 (42)</a> </h5> </li> </ol> </div> </aside> </div> </div> <footer class=footer> <div class=container> <div class=row> <p class="col-sm-12 text-center"> <a href="#">Back to top</a> </p> </div> </div> <nav class="navbar navbar-default footer-navbar"> <ul class="nav navbar-nav"> <li> <a href="https://github.com/gonzedge" class=social-link> <i class="fa fa-github"></i> </a> </li> </ul> </nav> </div> </footer> </body> </html>